<!DOCTYPE html><html class="no-js" lang="en"><head><!-- Google Tag Manager -->
<script async="" src="https://www.googletagmanager.com/gtm.js?id=GTM-NLGDMK5"></script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NLGDMK5');</script>
<!-- End Google Tag Manager -->
<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/">
<meta property="og:title" content="Metrics">
<meta property="og:type" content="website">
<meta property="og:url" content="http://docs.bentoml.org/guides/metrics.html">
<meta property="og:site_name" content="BentoML Documentation">
<meta property="og:description" content="time expected: 6 minutes Metrics are measurements of statistics about your service, which can provide information about the usage and performance of your bentos in production. BentoML allows users ...">
<meta property="og:image" content="http://docs.bentoml.org/_images/prometheus-metrics.png">
<meta property="og:image:alt" content="BentoML Documentation">
<meta name="description" content="time expected: 6 minutes Metrics are measurements of statistics about your service, which can provide information about the usage and performance of your bentos in production. BentoML allows users ...">
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Performance Guide" href="performance.html"><link rel="prev" title="Logging" href="logging.html">
        <link rel="canonical" href="https://docs.bentoml.org/en/latest/guides/metrics.html">

    <link rel="shortcut icon" href="../_static/favicon-96x96.ico"><!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
<script>
window.Papercups = {
    config: {
        // Pass in your Papercups account token here after signing up
        accountId: '25ad5fd9-293b-4e0f-9601-5b0cd7846b48',
        token: '25ad5fd9-293b-4e0f-9601-5b0cd7846b48',
        inbox: 'ac3ebd50-fc10-4299-9a1c-496841b49a6f',
        title: 'Welcome to BentoML!',
        subtitle: 'Ask us anything in the chat window below 😊',
        // newMessagePlaceholder: 'Start typing...',
        primaryColor: '#47AFD1',
        // Optionally pass in a default greeting
        greeting: "Hi there! How can I help you? If we couldn't get back to you in " +
                "time, feel free to join our community on slack and post your " +
                "question in the #support channel: https://l.linklyhq.com/l/ktOX",
        // Optionally pass in metadata to identify the customer
        // customer: {
        //   name: 'Test User',
        //   email: 'test@test.com',
        //   external_id: '123',
        //   metadata: {version: 1, plan: 'premium'}, // Custom fields go here
        // },
        // Optionally specify the base URL
        baseUrl: 'https://yatai-community-papercups.herokuapp.com',
        // Add this if you want to require the customer to enter
        // their email before being able to send you a message
        requireEmailUpfront: true,
        // Add this if you want to indicate when you/your agents
        // are online or offline to your customers
        showAgentAvailability: true,
    },
};
</script>
<script type="text/javascript" async="" defer="" src="https://app.papercups.io/widget.js"></script>

        <title>Metrics - BentoML</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css">
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53">
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css">
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.custom.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.bundle.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-shadow.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-punk.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-noir.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-light.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-borderless.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/micromodal.css">
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css">
    <link rel="stylesheet" type="text/css" href="/_/static/css/badge_only.css">
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e">
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css">
    
    


<style>
  body {
    --color-code-background: #3f3f3f;
  --color-code-foreground: #dcdccc;
  --color-brand-primary: #44a4c6 ;
  --color-brand-content: #44a4c6 ;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #c9378a ;
  --color-brand-content: #c9378a ;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #c9378a ;
  --color-brand-content: #c9378a ;
  
      }
    }
  }
</style>
<!-- RTD Extra Head -->

<link rel="stylesheet" href="/_/static/css/readthedocs-doc-embed.css" type="text/css">

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "build_date": "2023-03-27T14:27:39Z", "builder": "sphinx", "canonical_url": null, "commit": "6b4da8fe", "docroot": "/docs/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "guides/metrics", "programming_language": "py", "project": "bentoml", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {"yatai": "https://docs.bentoml.org/projects/yatai/en/latest/"}, "theme": "furo", "user_analytics_code": "UA-112879361-4", "version": "latest"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="/_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-theme="auto">
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NLGDMK5"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    


<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"></path>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M13 12h5"></path>
      <path d="M13 15h4"></path>
      <path d="M13 18h1"></path>
      <path d="M13 9h4"></path>
      <path d="M13 6h1"></path>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">BentoML</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.svg" alt="Logo">
  </div>
  
  <span class="sidebar-brand-text">BentoML</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial: Intro to BentoML</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../concepts/index.html">Main Concepts</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/model.html">Preparing Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/service.html">Service and APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/bento.html">Building Bentos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/runner.html">Using Runners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/deploy.html">Deploying Bento</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../frameworks/index.html">Framework Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/catboost.html">CatBoost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/fastai.html">fast.ai</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/keras.html">Keras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/lightgbm.html">LightGBM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/onnx.html">ONNX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/picklable.html">Picklable Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/pytorch.html">PyTorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/pytorch_lightning.html">PyTorch Lightning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/sklearn.html">Scikit-Learn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/tensorflow.html">TensorFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/transformers.html">Transformers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/xgboost.html">XGBoost</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Advanced Guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="batching.html">Adaptive Batching</a></li>
<li class="toctree-l2"><a class="reference internal" href="containerization.html">Advanced Containerization</a></li>
<li class="toctree-l2"><a class="reference internal" href="client.html">Bento Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="server.html">Bento Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="envmanager.html">Environment Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="graph.html">Inference Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html">Inference Data Collection &amp; Model Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">Performance Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="grpc.html">Serving with gRPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.html">Serving with GPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration.html">1.0 Migration Guide</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../integrations/index.html">Integrations</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../integrations/airflow.html">Airflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/arize.html">Arize AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/flink.html">Flink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/kubeflow.html">Kubeflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/mlflow.html">MLflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/spark.html">Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/triton.html">Triton Inference Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/core.html">Core Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/stores.html">Bento Store APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/api_io_descriptors.html">API IO Descriptors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/metrics.html">Metrics API</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/frameworks/index.html">Framework APIs</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/onnx.html">ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/sklearn.html">Scikit-Learn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/transformers.html">Transformers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/flax.html">Flax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/tensorflow.html">TensorFlow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/torchscript.html">TorchScript</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/xgboost.html">XGBoost</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/picklable_model.html">Picklable Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/pytorch.html">PyTorch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/lightgbm.html">LightGBM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/mlflow.html">MLflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/catboost.html">CatBoost</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/fastai.html">fast.ai</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/keras.html">Keras</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/ray.html">Ray</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/cli.html">BentoML CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/batch.html">Batch Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/container.html">Container APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bentoml/BentoML/tree/main/examples">Examples</a></li>
<li class="toctree-l1"><a class="reference external" href="https://l.linklyhq.com/l/ktOX">Community</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bentoml/BentoML">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://modelserving.com">Blog</a></li>
</ul>

</div>

<div id="furo-sidebar-ad-placement" class="flat" data-ea-publisher="readthedocs" data-ea-type="readthedocs-sidebar" data-ea-manual="true"></div>
</div>

<div id="furo-readthedocs-versions" class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions" tabindex="0">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book">&nbsp;</span>
    v: latest
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="/en/latest/">latest</a></dd>
      
        <dd><a href="/en/0.13-lts/">0.13-lts</a></dd>
      
    </dl>
    <dl>
      <dt>Downloads</dt>
      
    </dl>
    <dl>
      
      <dt>On Read the Docs</dt>
        <dd>
          <a href="//readthedocs.org/projects/bentoml/?fromdocs=bentoml">Project Home</a>
        </dd>
        <dd>
          <a href="//readthedocs.org/builds/bentoml/?fromdocs=bentoml">Builds</a>
        </dd>
    </dl>
  </div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/bentoml/bentoml/edit/main/docs/source/guides/metrics.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4"></path>
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5"></line>
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="metrics">
<h1>Metrics<a class="headerlink" href="#metrics" title="Permalink to this heading">#</a></h1>
<p><em>time expected: 6 minutes</em></p>
<p>Metrics are measurements of statistics about your service, which can provide information about the usage and performance of your bentos in production.</p>
<p>BentoML allows users to define custom metrics with <a class="reference external" href="https://prometheus.io/">Prometheus</a> to easily enable monitoring for their Bentos.</p>
<p>This article will dive into the default metrics and how to add custom metrics for
either a <a class="hxr-hoverxref hxr-tooltip reference internal" href="../concepts/runner.html#custom-runner"><span class="std std-ref">Custom Runner</span></a> or <a class="hxr-hoverxref hxr-tooltip reference internal" href="../concepts/service.html#service-and-apis"><span class="std std-ref">Service</span></a>.</p>
<p>Having a <a class="reference external" href="https://prometheus.io/docs/prometheus/latest/getting_started/">Prometheus server</a> available will help visualize the examples in this guide.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This article assumes that you have a base understanding of a BentoService. If you
are new to BentoML, please start with <a class="hxr-hoverxref hxr-tooltip reference internal" href="../tutorial.html#tutorial-intro-to-bentoml"><span class="std std-ref">the quickstart tutorial</span></a>.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>All <a class="reference external" href="https://prometheus.io/docs/concepts/metric_types/">metrics types</a> supported by Prometheus are supported in BentoML. See <a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/metrics.html#metrics-api"><span class="std std-ref">Metrics API</span></a> for more information on <code class="docutils literal notranslate"><span class="pre">bentoml.metrics</span></code>.</p>
</div>
<section id="default-metrics">
<h2>Default Metrics<a class="headerlink" href="#default-metrics" title="Permalink to this heading">#</a></h2>
<p>BentoML automatically collects the following metrics for all API Server and Runners by default across the following dimensions.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Description</p></th>
<th class="head"><p>Metric Name</p></th>
<th class="head"><p>Metric Type</p></th>
<th class="head"><p>Dimensions</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>API Server request in progress</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bentoml_api_server_request_in_progress</span></code></p></td>
<td><p>Gauge</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">endpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">service_name</span></code>, <code class="docutils literal notranslate"><span class="pre">service_version</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Runner request in progress</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bentoml_runner_request_in_progress</span></code></p></td>
<td><p>Gauge</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">endpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">runner_name</span></code>, <code class="docutils literal notranslate"><span class="pre">service_name</span></code>, <code class="docutils literal notranslate"><span class="pre">service_version</span></code></p></td>
</tr>
<tr class="row-even"><td><p>API Server request total</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bentoml_api_server_request_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">endpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">service_name</span></code>, <code class="docutils literal notranslate"><span class="pre">service_version</span></code>, <code class="docutils literal notranslate"><span class="pre">http_response_code</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Runner request total</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bentoml_runner_request_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">endpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">service_name</span></code>, <code class="docutils literal notranslate"><span class="pre">runner_name</span></code>, <code class="docutils literal notranslate"><span class="pre">service_version</span></code>, <code class="docutils literal notranslate"><span class="pre">http_response_code</span></code></p></td>
</tr>
<tr class="row-even"><td><p>API Server request duration in seconds</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bentoml_api_server_request_duration_seconds_sum</span></code>, <code class="docutils literal notranslate"><span class="pre">bentoml_api_server_request_duration_seconds_count</span></code>, <code class="docutils literal notranslate"><span class="pre">bentoml_api_server_request_duration_seconds_bucket</span></code></p></td>
<td><p>Histogram</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">endpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">service_name</span></code>, <code class="docutils literal notranslate"><span class="pre">service_version</span></code>, <code class="docutils literal notranslate"><span class="pre">http_response_code</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Runner request duration in seconds</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bentoml_runner_request_duration_seconds_sum</span></code>, <code class="docutils literal notranslate"><span class="pre">bentoml_runner_request_duration_seconds_count</span></code>, <code class="docutils literal notranslate"><span class="pre">bentoml_runner_request_duration_seconds_bucket</span></code></p></td>
<td><p>Histogram</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">endpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">service_name</span></code>, <code class="docutils literal notranslate"><span class="pre">runner_name</span></code>, <code class="docutils literal notranslate"><span class="pre">service_version</span></code>, <code class="docutils literal notranslate"><span class="pre">http_response_code</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Runner adaptive batch size</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bentoml_runner_adaptive_batch_size_sum</span></code>, <code class="docutils literal notranslate"><span class="pre">bentoml_runner_adaptive_batch_size_count</span></code>, <code class="docutils literal notranslate"><span class="pre">bentoml_runner_adaptive_batch_size_bucket</span></code></p></td>
<td><p>Histogram</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">method_name</span></code>, <code class="docutils literal notranslate"><span class="pre">service_name</span></code>, <code class="docutils literal notranslate"><span class="pre">runner_name</span></code>, <code class="docutils literal notranslate"><span class="pre">worker_index</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<section id="request-in-progress">
<h3>Request In-Progress<a class="headerlink" href="#request-in-progress" title="Permalink to this heading">#</a></h3>
<p>Measures the number of requests currently being processed by the API Server or Runner.</p>
</section>
<section id="request-total">
<h3>Request Total<a class="headerlink" href="#request-total" title="Permalink to this heading">#</a></h3>
<p>Measures the total number of requests processed by the API Server or Runner. The following PromQL expression returns the average request count
per-second over the last 1 minute for the <code class="docutils literal notranslate"><span class="pre">/classify</span></code> endpoint on the <code class="docutils literal notranslate"><span class="pre">iris_classifier</span></code> service.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>rate(bentoml_api_server_request_total{service_name="iris_classifier", endpoint="/classify"}[1m])
</pre></div>
</div>
</section>
<section id="request-duration">
<h3>Request Duration<a class="headerlink" href="#request-duration" title="Permalink to this heading">#</a></h3>
<p>Measures the durations of requests processed by the API Server or Runner. The accuracy of the histogram depends on the range and
granularity of the histogram buckets. By default, the Prometheus buckets covering the range from 0.005s to 10s are used. The following
configuration can be used to update the buckets configuration for the request duration metric. The configuration keys <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> indicates
the expected range of request duration to be tracked. The configuration key <code class="docutils literal notranslate"><span class="pre">factor</span></code> controls the granularity of the buckets and is used as
the exponential factor to generate the buckets. For example, the configuration below will generate the following buckets
<code class="docutils literal notranslate"><span class="pre">(0.1,</span> <span class="pre">0.2,</span> <span class="pre">0.4,</span> <span class="pre">0.8,</span> <span class="pre">1.6,</span> <span class="pre">3.2,</span> <span class="pre">5.0,</span> <span class="pre">inf)</span></code>. See the <a class="hxr-hoverxref hxr-tooltip reference internal" href="configuration.html#configuration"><span class="std std-ref">configuration</span></a> guide for more information on
how to configure BentoML.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">⚙️ <cite>configuration.yml</cite></span><a class="headerlink" href="#id2" title="Permalink to this code">#</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">api_server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">    </span><span class="nt">duration</span><span class="p">:</span>
<span class="w">      </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">      </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>
<span class="w">      </span><span class="nt">factor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.0</span>
</pre></div>
</div>
</div>
<p>The following PromQL expression returns the 99th percentile of the request duration over the last 1 minute for the <code class="docutils literal notranslate"><span class="pre">/classify</span></code> endpoint
on the <code class="docutils literal notranslate"><span class="pre">iris_classifier</span></code> service.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>histogram_quantile(0.99, rate(bentoml_api_server_request_duration_seconds_bucket{service_name="iris_classifier", endpoint="/classify"}[1m]))
</pre></div>
</div>
</section>
<section id="adaptive-batch-size">
<h3>Adaptive Batch Size<a class="headerlink" href="#adaptive-batch-size" title="Permalink to this heading">#</a></h3>
<p>Measures the batch size used by the <a class="hxr-hoverxref hxr-tooltip reference internal" href="batching.html#adaptive-batching"><span class="std std-ref">adaptive batching</span></a> feature in the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../concepts/runner.html#using-runners"><span class="std std-ref">runner</span></a>.
The following PromQL expression returns the 75th percentile of the batch size over the last 1 minute for the <code class="docutils literal notranslate"><span class="pre">iris_classifier</span></code> service.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>histogram_quantile(0.75, rate(bentoml_runner_adaptive_batch_size_bucket{service_name="iris_classifier"}[1m]))
</pre></div>
</div>
</section>
</section>
<section id="custom-metrics">
<h2>Custom Metrics<a class="headerlink" href="#custom-metrics" title="Permalink to this heading">#</a></h2>
<p>We will build a custom histogram to track the latency of our <a class="hxr-hoverxref hxr-tooltip reference internal" href="../concepts/runner.html#custom-runner"><span class="std std-ref">pretrained NLTK runner</span></a>, a custom
counter to measure the total amount of time our endpoint is invoked.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The source code for this custom runner is <a class="reference external" href="https://github.com/bentoml/BentoML/tree/main/examples/custom_runner/nltk_pretrained_model">available on GitHub</a>.</p>
</div>
<p>Initialize our metrics as follow:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><cite>service.py</cite></span><a class="headerlink" href="#id3" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">bentoml</span>

<span class="n">inference_duration</span> <span class="o">=</span> <span class="n">bentoml</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"inference_duration"</span><span class="p">,</span>
    <span class="n">documentation</span><span class="o">=</span><span class="s2">"Duration of inference"</span><span class="p">,</span>
    <span class="n">labelnames</span><span class="o">=</span><span class="p">[</span><span class="s2">"nltk_version"</span><span class="p">,</span> <span class="s2">"sentiment_cls"</span><span class="p">],</span>
    <span class="n">buckets</span><span class="o">=</span><span class="p">(</span>
        <span class="mf">0.005</span><span class="p">,</span>
        <span class="mf">0.01</span><span class="p">,</span>
        <span class="mf">0.025</span><span class="p">,</span>
        <span class="mf">0.05</span><span class="p">,</span>
        <span class="mf">0.075</span><span class="p">,</span>
        <span class="mf">0.1</span><span class="p">,</span>
        <span class="mf">0.25</span><span class="p">,</span>
        <span class="mf">0.5</span><span class="p">,</span>
        <span class="mf">0.75</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">2.5</span><span class="p">,</span>
        <span class="mf">5.0</span><span class="p">,</span>
        <span class="mf">7.5</span><span class="p">,</span>
        <span class="mf">10.0</span><span class="p">,</span>
        <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">polarity_counter</span> <span class="o">=</span> <span class="n">bentoml</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"polarity_total"</span><span class="p">,</span>
    <span class="n">documentation</span><span class="o">=</span><span class="s2">"Count total number of analysis by polarity scores"</span><span class="p">,</span>
    <span class="n">labelnames</span><span class="o">=</span><span class="p">[</span><span class="s2">"polarity"</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">inference_duration</span></code> is a <code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.metrics.Histogram()</span></code>, which tracks how long it
takes for our model to run inference.
The <code class="xref py py-attr docutils literal notranslate"><span class="pre">bentoml.metrics.Histogram.buckets</span></code> argument is used to determine the granularity of histogram tracking. The range of the buckets should cover the range of values the histogram is expected track. Number of buckets is positively correlated to the the granularity of tracking. The last value of the bucket should always be the positive infinity. See Prometheus documentation on <a class="reference external" href="https://prometheus.io/docs/practices/histograms/">Histogram</a> for more details.</p>
<p><code class="docutils literal notranslate"><span class="pre">polarity_counter</span></code> is a <code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.metrics.Counter()</span></code>, which tracks the total number
of analysis by the polarity scores.</p>
<blockquote class="epigraph">
<div><p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Note:</span> This also applies to any other metric type, including <code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.metrics.Gauge()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.metrics.Summary()</span></code>.</p>
</div></blockquote>
<p>Create our NLTK custom runner:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><cite>service.py</cite></span><a class="headerlink" href="#id4" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NLTKSentimentAnalysisRunnable</span><span class="p">(</span><span class="n">bentoml</span><span class="o">.</span><span class="n">Runnable</span><span class="p">):</span>
    <span class="n">SUPPORTED_RESOURCES</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"cpu"</span><span class="p">,)</span>
    <span class="n">SUPPORTS_CPU_MULTI_THREADING</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sia</span> <span class="o">=</span> <span class="n">SentimentIntensityAnalyzer</span><span class="p">()</span>

    <span class="nd">@bentoml</span><span class="o">.</span><span class="n">Runnable</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">batchable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">is_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sia</span><span class="o">.</span><span class="n">polarity_scores</span><span class="p">(</span><span class="n">sentence</span><span class="p">)[</span><span class="s2">"compound"</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">nltk</span><span class="o">.</span><span class="n">sent_tokenize</span><span class="p">(</span><span class="n">input_text</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">inference_duration</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span>
            <span class="n">nltk_version</span><span class="o">=</span><span class="n">nltk</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="n">sentiment_cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sia</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="p">)</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<p>This runnable implementation creates a custom NLTK runner, that use the <code class="docutils literal notranslate"><span class="pre">inference_duration</span></code>
histogram to track the latency of polarity scores from a given sentence.</p>
<p>Initialize our NLTK runner, and add it to the service:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nltk_runner</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
   <span class="s2">"RunnerImpl"</span><span class="p">,</span> <span class="n">bentoml</span><span class="o">.</span><span class="n">Runner</span><span class="p">(</span><span class="n">NLTKSentimentAnalysisRunnable</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"nltk_sentiment"</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">svc</span> <span class="o">=</span> <span class="n">bentoml</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="s2">"sentiment_analyzer"</span><span class="p">,</span> <span class="n">runners</span><span class="o">=</span><span class="p">[</span><span class="n">nltk_runner</span><span class="p">])</span>


<span class="nd">@svc</span><span class="o">.</span><span class="n">api</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">bentoml</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Text</span><span class="p">(),</span> <span class="n">output</span><span class="o">=</span><span class="n">bentoml</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">JSON</span><span class="p">())</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">analysis</span><span class="p">(</span><span class="n">input_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
    <span class="n">is_positive</span> <span class="o">=</span> <span class="k">await</span> <span class="n">nltk_runner</span><span class="o">.</span><span class="n">is_positive</span><span class="o">.</span><span class="n">async_run</span><span class="p">(</span><span class="n">input_text</span><span class="p">)</span>
    <span class="n">polarity_counter</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="n">polarity</span><span class="o">=</span><span class="n">is_positive</span><span class="p">)</span><span class="o">.</span><span class="n">inc</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">"is_positive"</span><span class="p">:</span> <span class="n">is_positive</span><span class="p">}</span>
</pre></div>
</div>
<p>Our endpoint <code class="docutils literal notranslate"><span class="pre">analysis</span></code> uses the <code class="docutils literal notranslate"><span class="pre">polarity_counter</span></code> to track the total number of
invocation for <code class="docutils literal notranslate"><span class="pre">analysis</span></code> by polarity scores.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-id="http" for="sd-tab-item-0">
HTTP</label><div class="sd-tab-content docutils">
<p>Serve our service:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>»<span class="w"> </span>bentoml<span class="w"> </span>serve-http<span class="w"> </span>--production
</pre></div>
</div>
<p>Use the following <code class="docutils literal notranslate"><span class="pre">prometheus.yml</span></code> config:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><cite>prometheus.yml</cite></span><a class="headerlink" href="#id5" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">global</span><span class="p">:</span>
  <span class="n">scrape_interval</span><span class="p">:</span> <span class="mi">5</span><span class="n">s</span>
  <span class="n">evaluation_interval</span><span class="p">:</span> <span class="mi">15</span><span class="n">s</span>

<span class="n">scrape_configs</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">job_name</span><span class="p">:</span> <span class="n">prometheus</span>
    <span class="n">metrics_path</span><span class="p">:</span> <span class="s2">"/metrics"</span>
    <span class="n">static_configs</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">targets</span><span class="p">:</span> <span class="p">[</span><span class="s2">"0.0.0.0:3000"</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Startup your Prometheus server in a different terminal session:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>»<span class="w"> </span>prometheus<span class="w"> </span>--config.file<span class="o">=</span>prometheus.yml
</pre></div>
</div>
<p>In a different terminal, send a request to our service:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>»<span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-F<span class="w"> </span><span class="s2">"image=@test_image.png"</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>http://0.0.0.0:3000/predict
</pre></div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-id="grpc" for="sd-tab-item-1">
gRPC</label><div class="sd-tab-content docutils">
<p>Serve our service:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>»<span class="w"> </span>bentoml<span class="w"> </span>serve-grpc<span class="w"> </span>--production<span class="w"> </span>--enable-reflection
</pre></div>
</div>
<p>Use the following <code class="docutils literal notranslate"><span class="pre">prometheus.yml</span></code> config:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><cite>prometheus.yml</cite></span><a class="headerlink" href="#id6" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">global</span><span class="p">:</span>
  <span class="n">scrape_interval</span><span class="p">:</span> <span class="mi">5</span><span class="n">s</span>
  <span class="n">evaluation_interval</span><span class="p">:</span> <span class="mi">15</span><span class="n">s</span>

<span class="n">scrape_configs</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">job_name</span><span class="p">:</span> <span class="n">prometheus</span>
    <span class="n">metrics_path</span><span class="p">:</span> <span class="s2">"/"</span>
    <span class="n">static_configs</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">targets</span><span class="p">:</span> <span class="p">[</span><span class="s2">"0.0.0.0:3001"</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Startup your Prometheus server in a different terminal session:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>»<span class="w"> </span>prometheus<span class="w"> </span>--config.file<span class="o">=</span>prometheus.yml
</pre></div>
</div>
<p>In a different terminal, send a request to our service:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>»<span class="w"> </span>grpcurl<span class="w"> </span>-d<span class="w"> </span>@<span class="w"> </span>-plaintext<span class="w"> </span><span class="m">0</span>.0.0.0:3000<span class="w"> </span>bentoml.grpc.v1.BentoService/Call<span class="w"> </span><span class="s">&lt;&lt;EOT</span>
<span class="s">  {</span>
<span class="s">    "apiName": "predict",</span>
<span class="s">    "serializedBytes": "..."</span>
<span class="s">  }</span>
<span class="s">  EOT</span>
</pre></div>
</div>
</div>
</div>
<p>Visit <a class="reference external" href="http://localhost:9090/graph">http://localhost:9090/graph</a> and use the following query for 95th percentile inference latency:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>histogram_quantile(0.95, rate(inference_duration_bucket[1m]))
</pre></div>
</div>
<img alt="../_images/prometheus-metrics.png" src="../_images/prometheus-metrics.png">
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<ul class="simple">
<li><p>Grafana dashboard</p></li>
</ul>
</div>
<div class="admonition-help-us-improve-the-project admonition">
<p class="admonition-title">Help us improve the project!</p>
<p>Found an issue or a TODO item? You’re always welcome to make contributions to the
project and its documentation. Check out the
<a class="reference external" href="https://github.com/bentoml/BentoML/blob/main/DEVELOPMENT.md">BentoML development guide</a>
and <a class="reference external" href="https://github.com/bentoml/BentoML/blob/main/docs/README.md">documentation guide</a>
to get started.</p>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="performance.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Performance Guide</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="logging.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Logging</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright © 2022-2023, bentoml.com
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/bentoml/bentoml" aria-label="GitHub"> 🍱 </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Metrics</a><ul>
<li><a class="reference internal" href="#default-metrics">Default Metrics</a><ul>
<li><a class="reference internal" href="#request-in-progress">Request In-Progress</a></li>
<li><a class="reference internal" href="#request-total">Request Total</a></li>
<li><a class="reference internal" href="#request-duration">Request Duration</a></li>
<li><a class="reference internal" href="#adaptive-batch-size">Adaptive Batch Size</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-metrics">Custom Metrics</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/js/hoverxref.js"></script>
    <script src="../_static/js/tooltipster.bundle.min.js"></script>
    <script src="../_static/js/micromodal.min.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async="async" src="/_/static/javascript/readthedocs-doc-embed.js"></script>
    <script src="../_static/js/custom.js"></script>
    
<div id="PapercupsChatWidget"></div></body></html>