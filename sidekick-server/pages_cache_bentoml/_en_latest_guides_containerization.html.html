<!DOCTYPE html><html class="no-js" lang="en"><head><!-- Google Tag Manager -->
<script type="text/javascript" async="" src="https://snap.licdn.com/li.lms-analytics/insight.min.js"></script><script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script async="" src="https://www.googletagmanager.com/gtm.js?id=GTM-NLGDMK5"></script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NLGDMK5');</script>
<!-- End Google Tag Manager -->
<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/">
<meta property="og:title" content="Advanced Containerization">
<meta property="og:type" content="website">
<meta property="og:url" content="http://docs.bentoml.org/guides/containerization.html">
<meta property="og:site_name" content="BentoML Documentation">
<meta property="og:description" content="time expected: 12 minutes This guide describes advanced containerization options provided by BentoML: Using base image, Using dockerfile template. This is an advanced feature for user to customize ...">
<meta property="og:image" content="https://docs.bentoml.org/en/latest/_images/bentoml-banner.png">
<meta property="og:image:alt" content="BentoML Documentation">
<meta name="description" content="time expected: 12 minutes This guide describes advanced containerization options provided by BentoML: Using base image, Using dockerfile template. This is an advanced feature for user to customize ...">
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Bento Client" href="client.html"><link rel="prev" title="Adaptive Batching" href="batching.html">
        <link rel="canonical" href="https://docs.bentoml.org/en/latest/guides/containerization.html">

    <link rel="shortcut icon" href="../_static/favicon-96x96.ico"><!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
<script>
window.Papercups = {
    config: {
        // Pass in your Papercups account token here after signing up
        accountId: '25ad5fd9-293b-4e0f-9601-5b0cd7846b48',
        token: '25ad5fd9-293b-4e0f-9601-5b0cd7846b48',
        inbox: 'ac3ebd50-fc10-4299-9a1c-496841b49a6f',
        title: 'Welcome to BentoML!',
        subtitle: 'Ask us anything in the chat window below 😊',
        // newMessagePlaceholder: 'Start typing...',
        primaryColor: '#47AFD1',
        // Optionally pass in a default greeting
        greeting: "Hi there! How can I help you? If we couldn't get back to you in " +
                "time, feel free to join our community on slack and post your " +
                "question in the #support channel: https://l.linklyhq.com/l/ktOX",
        // Optionally pass in metadata to identify the customer
        // customer: {
        //   name: 'Test User',
        //   email: 'test@test.com',
        //   external_id: '123',
        //   metadata: {version: 1, plan: 'premium'}, // Custom fields go here
        // },
        // Optionally specify the base URL
        baseUrl: 'https://yatai-community-papercups.herokuapp.com',
        // Add this if you want to require the customer to enter
        // their email before being able to send you a message
        requireEmailUpfront: true,
        // Add this if you want to indicate when you/your agents
        // are online or offline to your customers
        showAgentAvailability: true,
    },
};
</script>
<script type="text/javascript" async="" defer="" src="https://app.papercups.io/widget.js"></script>

        <title>Advanced Containerization - BentoML</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css">
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53">
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css">
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.custom.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.bundle.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-shadow.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-punk.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-noir.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-light.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-borderless.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/micromodal.css">
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css">
    <link rel="stylesheet" type="text/css" href="/_/static/css/badge_only.css">
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e">
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css">
    
    


<style>
  body {
    --color-code-background: #3f3f3f;
  --color-code-foreground: #dcdccc;
  --color-brand-primary: #44a4c6 ;
  --color-brand-content: #44a4c6 ;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #c9378a ;
  --color-brand-content: #c9378a ;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #c9378a ;
  --color-brand-content: #c9378a ;
  
      }
    }
  }
</style>
<!-- RTD Extra Head -->

<link rel="stylesheet" href="/_/static/css/readthedocs-doc-embed.css" type="text/css">

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "build_date": "2023-03-27T14:27:38Z", "builder": "sphinx", "canonical_url": null, "commit": "6b4da8fe", "docroot": "/docs/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "guides/containerization", "programming_language": "py", "project": "bentoml", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {"yatai": "https://docs.bentoml.org/projects/yatai/en/latest/"}, "theme": "furo", "user_analytics_code": "UA-112879361-4", "version": "latest"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="/_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
<style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style id="MJX-CHTML-styles">
mjx-container[jax="CHTML"] {
  line-height: 0;
}

mjx-container [space="1"] {
  margin-left: .111em;
}

mjx-container [space="2"] {
  margin-left: .167em;
}

mjx-container [space="3"] {
  margin-left: .222em;
}

mjx-container [space="4"] {
  margin-left: .278em;
}

mjx-container [space="5"] {
  margin-left: .333em;
}

mjx-container [rspace="1"] {
  margin-right: .111em;
}

mjx-container [rspace="2"] {
  margin-right: .167em;
}

mjx-container [rspace="3"] {
  margin-right: .222em;
}

mjx-container [rspace="4"] {
  margin-right: .278em;
}

mjx-container [rspace="5"] {
  margin-right: .333em;
}

mjx-container [size="s"] {
  font-size: 70.7%;
}

mjx-container [size="ss"] {
  font-size: 50%;
}

mjx-container [size="Tn"] {
  font-size: 60%;
}

mjx-container [size="sm"] {
  font-size: 85%;
}

mjx-container [size="lg"] {
  font-size: 120%;
}

mjx-container [size="Lg"] {
  font-size: 144%;
}

mjx-container [size="LG"] {
  font-size: 173%;
}

mjx-container [size="hg"] {
  font-size: 207%;
}

mjx-container [size="HG"] {
  font-size: 249%;
}

mjx-container [width="full"] {
  width: 100%;
}

mjx-box {
  display: inline-block;
}

mjx-block {
  display: block;
}

mjx-itable {
  display: inline-table;
}

mjx-row {
  display: table-row;
}

mjx-row > * {
  display: table-cell;
}

mjx-mtext {
  display: inline-block;
}

mjx-mstyle {
  display: inline-block;
}

mjx-merror {
  display: inline-block;
  color: red;
  background-color: yellow;
}

mjx-mphantom {
  visibility: hidden;
}

_::-webkit-full-page-media, _:future, :root mjx-container {
  will-change: opacity;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-c::before {
  display: block;
  width: 0;
}

.MJX-TEX {
  font-family: MJXZERO, MJXTEX;
}

.TEX-B {
  font-family: MJXZERO, MJXTEX-B;
}

.TEX-I {
  font-family: MJXZERO, MJXTEX-I;
}

.TEX-MI {
  font-family: MJXZERO, MJXTEX-MI;
}

.TEX-BI {
  font-family: MJXZERO, MJXTEX-BI;
}

.TEX-S1 {
  font-family: MJXZERO, MJXTEX-S1;
}

.TEX-S2 {
  font-family: MJXZERO, MJXTEX-S2;
}

.TEX-S3 {
  font-family: MJXZERO, MJXTEX-S3;
}

.TEX-S4 {
  font-family: MJXZERO, MJXTEX-S4;
}

.TEX-A {
  font-family: MJXZERO, MJXTEX-A;
}

.TEX-C {
  font-family: MJXZERO, MJXTEX-C;
}

.TEX-CB {
  font-family: MJXZERO, MJXTEX-CB;
}

.TEX-FR {
  font-family: MJXZERO, MJXTEX-FR;
}

.TEX-FRB {
  font-family: MJXZERO, MJXTEX-FRB;
}

.TEX-SS {
  font-family: MJXZERO, MJXTEX-SS;
}

.TEX-SSB {
  font-family: MJXZERO, MJXTEX-SSB;
}

.TEX-SSI {
  font-family: MJXZERO, MJXTEX-SSI;
}

.TEX-SC {
  font-family: MJXZERO, MJXTEX-SC;
}

.TEX-T {
  font-family: MJXZERO, MJXTEX-T;
}

.TEX-V {
  font-family: MJXZERO, MJXTEX-V;
}

.TEX-VB {
  font-family: MJXZERO, MJXTEX-VB;
}

mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c {
  font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A ! important;
}

@font-face /* 0 */ {
  font-family: MJXZERO;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Zero.woff") format("woff");
}

@font-face /* 1 */ {
  font-family: MJXTEX;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff") format("woff");
}

@font-face /* 2 */ {
  font-family: MJXTEX-B;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Bold.woff") format("woff");
}

@font-face /* 3 */ {
  font-family: MJXTEX-I;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-Italic.woff") format("woff");
}

@font-face /* 4 */ {
  font-family: MJXTEX-MI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Italic.woff") format("woff");
}

@font-face /* 5 */ {
  font-family: MJXTEX-BI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-BoldItalic.woff") format("woff");
}

@font-face /* 6 */ {
  font-family: MJXTEX-S1;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff") format("woff");
}

@font-face /* 7 */ {
  font-family: MJXTEX-S2;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size2-Regular.woff") format("woff");
}

@font-face /* 8 */ {
  font-family: MJXTEX-S3;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size3-Regular.woff") format("woff");
}

@font-face /* 9 */ {
  font-family: MJXTEX-S4;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size4-Regular.woff") format("woff");
}

@font-face /* 10 */ {
  font-family: MJXTEX-A;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_AMS-Regular.woff") format("woff");
}

@font-face /* 11 */ {
  font-family: MJXTEX-C;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Regular.woff") format("woff");
}

@font-face /* 12 */ {
  font-family: MJXTEX-CB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Bold.woff") format("woff");
}

@font-face /* 13 */ {
  font-family: MJXTEX-FR;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Regular.woff") format("woff");
}

@font-face /* 14 */ {
  font-family: MJXTEX-FRB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Bold.woff") format("woff");
}

@font-face /* 15 */ {
  font-family: MJXTEX-SS;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Regular.woff") format("woff");
}

@font-face /* 16 */ {
  font-family: MJXTEX-SSB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Bold.woff") format("woff");
}

@font-face /* 17 */ {
  font-family: MJXTEX-SSI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Italic.woff") format("woff");
}

@font-face /* 18 */ {
  font-family: MJXTEX-SC;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Script-Regular.woff") format("woff");
}

@font-face /* 19 */ {
  font-family: MJXTEX-T;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Typewriter-Regular.woff") format("woff");
}

@font-face /* 20 */ {
  font-family: MJXTEX-V;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Regular.woff") format("woff");
}

@font-face /* 21 */ {
  font-family: MJXTEX-VB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Bold.woff") format("woff");
}
</style><style data-emotion="css"></style></head>
  <body data-theme="auto">
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NLGDMK5"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    


<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"></path>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M13 12h5"></path>
      <path d="M13 15h4"></path>
      <path d="M13 18h1"></path>
      <path d="M13 9h4"></path>
      <path d="M13 6h1"></path>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">BentoML</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.svg" alt="Logo">
  </div>
  
  <span class="sidebar-brand-text">BentoML</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial: Intro to BentoML</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../concepts/index.html">Main Concepts</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/model.html">Preparing Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/service.html">Service and APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/bento.html">Building Bentos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/runner.html">Using Runners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/deploy.html">Deploying Bento</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../frameworks/index.html">Framework Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/catboost.html">CatBoost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/fastai.html">fast.ai</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/keras.html">Keras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/lightgbm.html">LightGBM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/onnx.html">ONNX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/picklable.html">Picklable Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/pytorch.html">PyTorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/pytorch_lightning.html">PyTorch Lightning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/sklearn.html">Scikit-Learn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/tensorflow.html">TensorFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/transformers.html">Transformers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/xgboost.html">XGBoost</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Advanced Guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="batching.html">Adaptive Batching</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Advanced Containerization</a></li>
<li class="toctree-l2"><a class="reference internal" href="client.html">Bento Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="server.html">Bento Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="envmanager.html">Environment Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="graph.html">Inference Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html">Inference Data Collection &amp; Model Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">Performance Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="grpc.html">Serving with gRPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.html">Serving with GPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration.html">1.0 Migration Guide</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../integrations/index.html">Integrations</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../integrations/airflow.html">Airflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/arize.html">Arize AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/flink.html">Flink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/kubeflow.html">Kubeflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/mlflow.html">MLflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/spark.html">Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/triton.html">Triton Inference Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/core.html">Core Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/stores.html">Bento Store APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/api_io_descriptors.html">API IO Descriptors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/metrics.html">Metrics API</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/frameworks/index.html">Framework APIs</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/onnx.html">ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/sklearn.html">Scikit-Learn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/transformers.html">Transformers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/flax.html">Flax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/tensorflow.html">TensorFlow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/torchscript.html">TorchScript</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/xgboost.html">XGBoost</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/picklable_model.html">Picklable Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/pytorch.html">PyTorch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/lightgbm.html">LightGBM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/mlflow.html">MLflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/catboost.html">CatBoost</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/fastai.html">fast.ai</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/keras.html">Keras</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/ray.html">Ray</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/cli.html">BentoML CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/batch.html">Batch Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/container.html">Container APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bentoml/BentoML/tree/main/examples">Examples</a></li>
<li class="toctree-l1"><a class="reference external" href="https://l.linklyhq.com/l/ktOX">Community</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bentoml/BentoML">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://modelserving.com">Blog</a></li>
</ul>

</div>

<div id="furo-sidebar-ad-placement" class="flat" data-ea-publisher="readthedocs" data-ea-type="readthedocs-sidebar" data-ea-manual="true"></div>
</div>

<div id="furo-readthedocs-versions" class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions" tabindex="0">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book">&nbsp;</span>
    v: latest
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="/en/latest/">latest</a></dd>
      
        <dd><a href="/en/0.13-lts/">0.13-lts</a></dd>
      
    </dl>
    <dl>
      <dt>Downloads</dt>
      
    </dl>
    <dl>
      
      <dt>On Read the Docs</dt>
        <dd>
          <a href="//readthedocs.org/projects/bentoml/?fromdocs=bentoml">Project Home</a>
        </dd>
        <dd>
          <a href="//readthedocs.org/builds/bentoml/?fromdocs=bentoml">Builds</a>
        </dd>
    </dl>
  </div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/bentoml/bentoml/edit/main/docs/source/guides/containerization.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4"></path>
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5"></line>
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="advanced-containerization">
<h1>Advanced Containerization<a class="headerlink" href="#advanced-containerization" title="Permalink to this heading">#</a></h1>
<p><em>time expected: 12 minutes</em></p>
<p>This guide describes advanced containerization options
provided by BentoML:</p>
<ul class="simple">
<li><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#custom-base-image"><span class="std std-ref">Using base image</span></a></p></li>
<li><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#dockerfile-template"><span class="std std-ref">Using dockerfile template</span></a></p></li>
</ul>
<p>This is an advanced feature for user to customize container environment that are not directly supported in BentoML.
For basic containerizing options, see <a class="hxr-hoverxref hxr-tooltip reference internal" href="../concepts/bento.html#docker-options"><span class="std std-ref">Docker Options</span></a>.</p>
<section id="why-you-may-need-this">
<h2>Why you may need this?<a class="headerlink" href="#why-you-may-need-this" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>If you want to customize the containerization process of your Bento.</p></li>
<li><p>If you need a certain tools, configs, prebuilt binaries that is available across all your Bento generated container images.</p></li>
<li><p>A big difference with <a class="hxr-hoverxref hxr-tooltip reference internal" href="../concepts/bento.html#docker-options-table"><span class="std std-ref">base image</span></a> features is that you don’t have to setup a custom base image and then push it to a remote registry.</p></li>
</ul>
</section>
<section id="custom-base-image">
<h2>Custom Base Image<a class="headerlink" href="#custom-base-image" title="Permalink to this heading">#</a></h2>
<p>If none of the provided distros work for your use case, e.g. if your infrastructure
requires all docker images to be derived from the same base image with certain security
fixes and libraries, you can config BentoML to use your base image instead:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">base_image</span><span class="p">:</span><span class="w"> </span><span class="s">"my_custom_image:latest"</span>
</pre></div>
</div>
<p>When a <code class="code docutils literal notranslate"><span class="pre">base_image</span></code> is provided, <strong>all other docker options will be ignored</strong>,
(distro, cuda_version, system_packages, python_version). <code class="code docutils literal notranslate"><span class="pre">bentoml</span> <span class="pre">containerize</span></code>
will build a new image on top of the base_image with the following steps:</p>
<ul class="simple">
<li><p>setup env vars</p></li>
<li><p>run the <code class="code docutils literal notranslate"><span class="pre">setup_script</span></code> if provided</p></li>
<li><p>install the required Python packages</p></li>
<li><p>copy over the Bento file</p></li>
<li><p>setup the entrypoint command for serving.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><span class="sd-sphinx-override sd-badge sd-bg-warning sd-bg-text-warning">Warning:</span> user must ensure that the provided base image has desired
Python version installed. If the base image you have doesn’t have Python, you may
install python via a <code class="code docutils literal notranslate"><span class="pre">setup_script</span></code>. The implementation of the script depends
on the base image distro or the package manager available.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">base_image</span><span class="p">:</span><span class="w"> </span><span class="s">"my_custom_image:latest"</span>
<span class="w">    </span><span class="nt">setup_script</span><span class="p">:</span><span class="w"> </span><span class="s">"./setup.sh"</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>By default, BentoML supports multi-platform docker image build out-of-the-box.
However, when a custom <code class="code docutils literal notranslate"><span class="pre">base_image</span></code> is provided, the generated Dockerfile can
only be used for building linux/amd64 platform docker images.</p>
<p>If you are running BentoML from an Apple M1 device or an ARM based computer, make
sure to pass the <code class="code docutils literal notranslate"><span class="pre">--opt</span> <span class="pre">platform=linux/amd64</span></code> parameter when containerizing a Bento. e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bentoml<span class="w"> </span>containerize<span class="w"> </span>iris_classifier:latest<span class="w"> </span>--opt<span class="w"> </span><span class="nv">platform</span><span class="o">=</span>linux/amd64
</pre></div>
</div>
</div>
</section>
<section id="dockerfile-template">
<h2>Dockerfile Template<a class="headerlink" href="#dockerfile-template" title="Permalink to this heading">#</a></h2>
<p>The <code class="code docutils literal notranslate"><span class="pre">dockerfile_template</span></code> field gives the user full control over how the
<code class="code docutils literal notranslate"><span class="pre">Dockerfile</span></code> is generated for a Bento by extending the template used by
BentoML.</p>
<p>First, create a <code class="code docutils literal notranslate"><span class="pre">Dockerfile.template</span></code> file next to your <code class="code docutils literal notranslate"><span class="pre">bentofile.yaml</span></code>
build file. This file should follow the
<a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/">Jinja2</a> template language, and extend
BentoML’s base template and blocks. The template should render a valid
<a class="reference external" href="https://docs.docker.com/engine/reference/builder/">Dockerfile</a>. For example:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">bento_base_template</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">SETUP_BENTO_COMPONENTS</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>
<span class="x">RUN echo "We are running this during bentoml containerize!"</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Then add the path to your template file to the <code class="code docutils literal notranslate"><span class="pre">dockerfile_template</span></code> field in
your :code: <cite>bentofile.yaml</cite>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dockerfile_template</span><span class="p">:</span><span class="w"> </span><span class="s">"./Dockerfile.template"</span>
</pre></div>
</div>
<p>Now run <code class="code docutils literal notranslate"><span class="pre">bentoml</span> <span class="pre">build</span></code> to build a new Bento. It will contain a Dockerfile
generated with the custom template. To confirm the generated Dockerfile works as
expected, run <code class="code docutils literal notranslate"><span class="pre">bentoml</span> <span class="pre">containerize</span> <span class="pre">&lt;bento&gt;</span></code> to build a docker image with it.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg></span>View the generated Dockerfile content<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">During development and debugging, you may want to see the generated Dockerfile.
Here’s shortcut for that:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span><span class="s2">"</span><span class="k">$(</span>bentoml<span class="w"> </span>get<span class="w"> </span>&lt;bento&gt;:&lt;tag&gt;<span class="w"> </span>-o<span class="w"> </span>path<span class="k">)</span><span class="s2">/env/docker/Dockerfile"</span>
</pre></div>
</div>
</div>
</details></section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#building-tensorflow-custom-op"><span class="std std-ref">Building TensorFlow custom op</span></a></p></li>
<li><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#access-aws-credentials-during-image-build"><span class="std std-ref">Access AWS credentials during image build</span></a></p></li>
</ol>
<section id="building-tensorflow-custom-op">
<h3>Building TensorFlow custom op<a class="headerlink" href="#building-tensorflow-custom-op" title="Permalink to this heading">#</a></h3>
<p>Let’s start with an example that builds a <a class="reference external" href="https://www.tensorflow.org/guide/create_op">custom TensorFlow op</a> binary into a Bento, which is based on <a class="reference external" href="https://www.tensorflow.org/guide/create_op#define_the_op_interface"><code class="code docutils literal notranslate"><span class="pre">zero_out.cc</span></code> implementation details</a>:</p>
<p>Define the following <code class="code docutils literal notranslate"><span class="pre">Dockerfile.template</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><cite>Dockerfile.template</cite></span><a class="headerlink" href="#id5" title="Permalink to this code">#</a></div>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">bento_base_template</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">SETUP_BENTO_BASE_IMAGE</span> <span class="cp">%}</span>

<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>

<span class="x">WORKDIR /tmp</span>

<span class="x">COPY ./src/tfops/zero_out.cc .</span>

<span class="x">RUN pip3 install tensorflow</span>
<span class="x">RUN set -ex &amp;&amp; \</span>
<span class="x">	TF_CFLAGS=( $(python3 -c 'import tensorflow as tf; print(" ".join(tf.sysconfig.get_compile_flags()))') ) &amp;&amp; \</span>
<span class="x">	TF_LFLAGS=( $(python3 -c 'import tensorflow as tf; print(" ".join(tf.sysconfig.get_link_flags()))') ) &amp;&amp; \</span>
<span class="x">	g++ --std=c++14 -shared zero_out.cc -o zero_out.so -fPIC ${TF_CFLAGS[@]} ${TF_LFLAGS[@]} -I$(python -c 'import tensorflow as tf; print(tf.sysconfig.get_include());') -D_GLIBCXX_USE_CXX11_ABI=0 -O2</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">SETUP_BENTO_COMPONENTS</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>
<span class="x">RUN stat /usr/lib/zero_out.so</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<p>Then add the following to your <code class="code docutils literal notranslate"><span class="pre">bentofile.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">include</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"zero_out.cc"</span>
<span class="nt">python</span><span class="p">:</span>
<span class="w">  </span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tensorflow</span>
<span class="nt">docker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dockerfile_template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Dockerfile.template</span>
</pre></div>
</div>
<p>Proceed to build your Bento with <code class="code docutils literal notranslate"><span class="pre">bentoml</span> <span class="pre">build</span></code> and containerize with <code class="code docutils literal notranslate"><span class="pre">bentoml</span> <span class="pre">containerize</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bentoml<span class="w"> </span>build

bentoml<span class="w"> </span>containerize<span class="w"> </span>&lt;bento&gt;:&lt;tag&gt;
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can also provide <code class="code docutils literal notranslate"><span class="pre">--progress</span> <span class="pre">plain</span></code> to see the progress from
<a class="reference external" href="https://github.com/moby/buildkit">buildkit</a> in plain text</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">bentoml containerize --progress plain &lt;bento&gt;:&lt;tag&gt;</span>
</pre></div>
</div>
</div>
</section>
<section id="access-aws-credentials-during-image-build">
<h3>Access AWS credentials during image build<a class="headerlink" href="#access-aws-credentials-during-image-build" title="Permalink to this heading">#</a></h3>
<p>We will now demonstrate how to provide AWS credentials to a Bento via two approaches:</p>
<ol class="arabic simple">
<li><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#using-environment-variables"><span class="std std-ref">Using environment variables</span></a>.</p></li>
<li><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#mount-credentials-from-host"><span class="std std-ref">Mount credentials from host</span></a>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Remarks:</span> We recommend for most cases
to use the second option (<a class="hxr-hoverxref hxr-tooltip reference internal" href="#mount-credentials-from-host"><span class="std std-ref">Mount credentials from host</span></a>)
as it prevents any securities leak.</p>
<p>By default BentoML uses the latest <a class="reference external" href="https://hub.docker.com/r/docker/dockerfile">dockerfile frontend</a> which
allows mounting secrets to container.</p>
</div>
<p>For both examples, you will need to add the following to your <code class="code docutils literal notranslate"><span class="pre">bentofile.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">python</span><span class="p">:</span>
<span class="w">  </span><span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awscli</span>
<span class="nt">docker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dockerfile_template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Dockerfile.template</span>
</pre></div>
</div>
<section id="using-environment-variables">
<h4>Using environment variables<a class="headerlink" href="#using-environment-variables" title="Permalink to this heading">#</a></h4>
<p>Define the following <code class="code docutils literal notranslate"><span class="pre">Dockerfile.template</span></code>:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">bento_base_template</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">SETUP_BENTO_BASE_IMAGE</span> <span class="cp">%}</span>
<span class="x">ARG AWS_SECRET_ACCESS_KEY</span>
<span class="x">ARG AWS_ACCESS_KEY_ID</span>
<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>

<span class="x">ARG AWS_SECRET_ACCESS_KEY</span>
<span class="x">ARG AWS_ACCESS_KEY_ID</span>

<span class="x">ENV AWS_SECRET_ACCESS_KEY=$ARG AWS_SECRET_ACCESS_KEY</span>
<span class="x">ENV AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">SETUP_BENTO_COMPONENTS</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>

<span class="x">RUN aws s3 cp s3://path/to/file </span><span class="cp">{{</span> <span class="nv">bento__path</span> <span class="cp">}}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>After building the bento with <code class="code docutils literal notranslate"><span class="pre">bentoml</span> <span class="pre">build</span></code>, you can then
pass <code class="code docutils literal notranslate"><span class="pre">AWS_SECRET_ACCESS_KEY</span></code> and <code class="code docutils literal notranslate"><span class="pre">AWS_ACCESS_KEY_ID</span></code> as arguments to <code class="code docutils literal notranslate"><span class="pre">bentoml</span> <span class="pre">containerize</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bentoml<span class="w"> </span>containerize<span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="nv">$AWS_SECRET_ACCESS_KEY</span><span class="w"> </span><span class="se">\</span>
<span class="w">                     </span>--build-arg<span class="w"> </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="nv">$AWS_ACCESS_KEY_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">                     </span>&lt;bento&gt;:&lt;tag&gt;
</pre></div>
</div>
</section>
<section id="mount-credentials-from-host">
<h4>Mount credentials from host<a class="headerlink" href="#mount-credentials-from-host" title="Permalink to this heading">#</a></h4>
<p>Define the following <code class="code docutils literal notranslate"><span class="pre">Dockerfile.template</span></code>:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">bento_base_template</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">SETUP_BENTO_COMPONENTS</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>

<span class="x">RUN --mount=type=secret,id=aws,target=/root/.aws/credentials \</span>
<span class="x">     aws s3 cp s3://path/to/file </span><span class="cp">{{</span> <span class="nv">bento__path</span> <span class="cp">}}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Follow the above addition to <code class="code docutils literal notranslate"><span class="pre">bentofile.yaml</span></code> to include <code class="docutils literal notranslate"><span class="pre">awscli</span></code> and
the custom dockerfile template.</p>
<p>To pass in secrets to the Bento, pass it via <code class="code docutils literal notranslate"><span class="pre">--secret</span></code> to <code class="code docutils literal notranslate"><span class="pre">bentoml</span>
<span class="pre">containerize</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bentoml<span class="w"> </span>containerize<span class="w"> </span>--secret<span class="w"> </span><span class="nv">id</span><span class="o">=</span>aws,src<span class="o">=</span><span class="nv">$HOME</span>/.aws/credentials<span class="w"> </span>&lt;bento&gt;:&lt;tag&gt;
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax.md#run---mounttypesecret">Mounting Secrets</a></p>
</div>
</section>
</section>
</section>
<section id="writing-dockerfile-template">
<h2>Writing <code class="code docutils literal notranslate"><span class="pre">dockerfile_template</span></code><a class="headerlink" href="#writing-dockerfile-template" title="Permalink to this heading">#</a></h2>
<p>BentoML utilize <a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/">Jinja2</a> to
structure a <code class="code docutils literal notranslate"><span class="pre">Dockerfile.template</span></code>.</p>
<p>The Dockerfile template is a mix between <code class="code docutils literal notranslate"><span class="pre">Jinja2</span></code> syntax and <code class="code docutils literal notranslate"><span class="pre">Dockerfile</span></code>
syntax. BentoML set both <cite>trim_blocks</cite> and <cite>lstrip_blocks</cite> in Jinja
templates environment to <code class="code docutils literal notranslate"><span class="pre">True</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure that your Dockerfile instruction is <strong>unindented</strong> as if you are writting a normal Dockerfile.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#whitespace-control">Jinja Whitespace Control</a>.</p>
</div>
<p>An example of a Dockerfile template takes advantage of multi-stage build to
isolate the installation of a local library <code class="code docutils literal notranslate"><span class="pre">mypackage</span></code>:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">bento_base_template</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">SETUP_BENTO_BASE_IMAGE</span> <span class="cp">%}</span>
<span class="x">FROM --platform=$BUILDPLATFORM python:3.7-slim as buildstage</span>
<span class="x">RUN mkdir /tmp/mypackage</span>

<span class="x">WORKDIR /tmp/mypackage/</span>
<span class="x">COPY mypackage .</span>
<span class="x">RUN python setup.py sdist &amp;&amp; mv dist/mypackage-0.0.1.tar.gz mypackage.tar.gz</span>

<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">SETUP_BENTO_COMPONENTS</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>
<span class="x">COPY --from=buildstage mypackage.tar.gz /tmp/wheels/</span>
<span class="x">RUN --network=none pip install --find-links /tmp/wheels mypackage</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice how for all Dockerfile instruction, we consider as if the Jinja
logics aren’t there 🚀.</p>
</div>
<section id="jinja-templates">
<h3>Jinja templates<a class="headerlink" href="#jinja-templates" title="Permalink to this heading">#</a></h3>
<p>One of the powerful features Jinja offers is its <a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#template-inheritance">template inheritance</a>.
This allows BentoML to enable users to fully customize how to structure a Bento’s Dockerfile.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use a custom Dockerfile template, users have to provide a file with a format
that follows the Jinja2 template syntax. The template file should have
extensions of <code class="code docutils literal notranslate"><span class="pre">.j2</span></code>, <code class="code docutils literal notranslate"><span class="pre">.template</span></code>, <code class="code docutils literal notranslate"><span class="pre">.jinja</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is not meant to be a complete reference on Jinja2.
For any advanced features from on Jinja2, please refers to their <a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/templates/">Templates Design Documentation</a>.</p>
</div>
<p>To construct a custom <code class="code docutils literal notranslate"><span class="pre">Dockerfile</span></code> template, users have to provide an <a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#extends">extends block</a> at the beginning of the Dockerfile template <code class="code docutils literal notranslate"><span class="pre">Dockerfile.template</span></code> followed by the given base template name <code class="code docutils literal notranslate"><span class="pre">bento_base_template</span></code>:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">bento_base_template</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><span class="sd-sphinx-override sd-badge sd-bg-warning sd-bg-text-warning">Warning:</span> If you pass in a generic <code class="code docutils literal notranslate"><span class="pre">Dockerfile</span></code> file, and then run <code class="code docutils literal notranslate"><span class="pre">bentoml</span> <span class="pre">build</span></code> to build a Bento and it doesn’t throw any errors.</p>
<p>However, when you try to run <code class="code docutils literal notranslate"><span class="pre">bentoml</span> <span class="pre">containerize</span></code>, this won’t work.</p>
<p>This is an expected behaviour from Jinja2, where Jinja2 accepts <strong>any file</strong> as a template.</p>
<p>We decided not to put any restrictions to validate the template file, simply because we want to enable
users to customize to their own needs.</p>
</div>
<section id="super">
<h4><code class="code docutils literal notranslate"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></code><a class="headerlink" href="#super" title="Permalink to this heading">#</a></h4>
<p>As you can notice throughout this guides, we use a special function <code class="code docutils literal notranslate"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></code>. This is a Jinja
features that allow users to call content of <a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#super-blocks">parent block</a>. This
enables users to fully extend base templates provided by BentoML to ensure that
the result Bentos can be containerized.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#super-blocks"><code class="code docutils literal notranslate"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></code> <em>Syntax</em></a> for more information on template inheritance.</p>
</div>
</section>
<section id="blocks">
<h4>Blocks<a class="headerlink" href="#blocks" title="Permalink to this heading">#</a></h4>
<p>BentoML defines a sets of <a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#base-template">Blocks</a> under the object <code class="code docutils literal notranslate"><span class="pre">bento_base_template</span></code>.</p>
<p>All exported blocks that users can use to extend are as follow:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Blocks</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">SETUP_BENTO_BASE_IMAGE</span></code></p></td>
<td><p>Instructions to set up multi architecture supports, base images as well as installing system packages that is defined by users.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">SETUP_BENTO_USER</span></code></p></td>
<td><p>Setup bento users with correct UID, GID and directory for a 🍱.</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">SETUP_BENTO_ENVARS</span></code></p></td>
<td><p>Add users environment variables (if specified) and other required variables from BentoML.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">SETUP_BENTO_COMPONENTS</span></code></p></td>
<td><p>Setup components for a 🍱 , including installing pip packages, running setup scripts, installing bentoml, etc.</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">SETUP_BENTO_ENTRYPOINT</span></code></p></td>
<td><p>Finalize ports and set <code class="code docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> and <code class="code docutils literal notranslate"><span class="pre">CMD</span></code> for the 🍱.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All the defined blocks are prefixed with <code class="code docutils literal notranslate"><span class="pre">SETUP_BENTO_*</span></code>. This is to
ensure that users can extend blocks defined by BentoML without sacrificing
the flexibility of a Jinja template.</p>
</div>
<p>To extend any given block, users can do so by adding <code class="code docutils literal notranslate"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></code> at
any point inside block.</p>
</section>
</section>
<section id="dockerfile-instruction">
<h3>Dockerfile instruction<a class="headerlink" href="#dockerfile-instruction" title="Permalink to this heading">#</a></h3>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://docs.docker.com/engine/reference/builder">Dockerfile reference</a> for writing a Dockerfile.</p>
</div>
<p>We recommend that users should use the following Dockerfile instructions in
their custom Dockerfile templates: <code class="code docutils literal notranslate"><span class="pre">ENV</span></code>, <code class="code docutils literal notranslate"><span class="pre">RUN</span></code>, <code class="code docutils literal notranslate"><span class="pre">ARG</span></code>. These
instructions are mostly used and often times will get the jobs done.</p>
<p>The use of the following instructions can be <strong>potentially harmful</strong>. They should be reserved for specialized advanced use cases.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Instruction</p></th>
<th class="head"><p>Reasons not to use</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">FROM</span></code></p></td>
<td><p>Since the containerized Bento is a multi-stage builds container, adding <code class="code docutils literal notranslate"><span class="pre">FROM</span></code> statement will result in failure to containerize the given Bento.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">SHELL</span></code></p></td>
<td><p>BentoML uses <a class="reference external" href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax.md#user-content-here-documents">heredoc syntax</a> and using <code class="code docutils literal notranslate"><span class="pre">bash</span></code> in our containerization process. Hence changing <code class="code docutils literal notranslate"><span class="pre">SHELL</span></code> will result in failure.</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">CMD</span></code></p></td>
<td><p>Changing <code class="code docutils literal notranslate"><span class="pre">CMD</span></code> will inherently modify the behaviour of the bento container where docker won’t be able to run the bento inside the container. More <a class="hxr-hoverxref hxr-tooltip reference internal" href="#entrypoint"><span class="std std-ref">below</span></a></p></td>
</tr>
</tbody>
</table>
</div>
<p>The following instructions should be <strong>used with caution</strong>:</p>
<section id="workdir">
<h4><code class="code docutils literal notranslate"><span class="pre">WORKDIR</span></code><a class="headerlink" href="#workdir" title="Permalink to this heading">#</a></h4>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://docs.docker.com/engine/reference/builder/#workdir">WORKDIR reference</a></p>
</div>
<p>Since <code class="code docutils literal notranslate"><span class="pre">WORKDIR</span></code> determines the working directory for any <code class="code docutils literal notranslate"><span class="pre">RUN</span></code>, <code class="code docutils literal notranslate"><span class="pre">CMD</span></code>, <code class="code docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code>, <code class="code docutils literal notranslate"><span class="pre">COPY</span></code> and <code class="code docutils literal notranslate"><span class="pre">ADD</span></code> instructions that follow it in the Dockerfile,
make sure that your instructions define the correct path to any working files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, all paths for Bento-related files will be generated to its
fspath, which ensures that Bento will work regardless of <code class="code docutils literal notranslate"><span class="pre">WORKDIR</span></code></p>
</div>
</section>
<section id="entrypoint">
<h4><code class="code docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code><a class="headerlink" href="#entrypoint" title="Permalink to this heading">#</a></h4>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://docs.docker.com/engine/reference/builder/#entrypoint">ENTRYPOINT reference</a></p>
</div>
<p>The flexibility of a Jinja template also brings up the flexibility of setting up <code class="code docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> and <code class="code docutils literal notranslate"><span class="pre">CMD</span></code>.</p>
<p>From <a class="reference external" href="https://docs.docker.com/engine/reference/builder/#entrypoint">Dockerfile documentation</a>:</p>
<blockquote>
<div><p>Only the last <code class="code docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> instruction in the Dockerfile will have an effect.</p>
</div></blockquote>
<p>By default, a Bento sets:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">ENTRYPOINT [ "</span><span class="cp">{{</span> <span class="nv">bento__entrypoint</span> <span class="cp">}}</span><span class="x">" ]</span>

<span class="x">CMD ["bentoml", "serve", "</span><span class="cp">{{</span> <span class="nv">bento__path</span> <span class="cp">}}</span><span class="x">", "--production"]</span>
</pre></div>
</div>
<p>This aboved instructions ensure that whenever <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> is invoked on the 🍱 container, <code class="code docutils literal notranslate"><span class="pre">bentoml</span></code> is called correctly.</p>
<p>In scenarios where one needs to setup a custom <code class="code docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code>, make sure to use
the <code class="code docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> instruction under the <code class="code docutils literal notranslate"><span class="pre">SETUP_BENTO_ENTRYPOINT</span></code> block as follows:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">bento_base_template</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">SETUP_BENTO_ENTRYPOINT</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>

<span class="x">...</span>
<span class="x">ENTRYPOINT [ "</span><span class="cp">{{</span> <span class="nv">bento__entrypoint</span> <span class="cp">}}</span><span class="x">", "python", "-m", "awslambdaric" ]</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code class="code docutils literal notranslate"><span class="pre">{{</span> <span class="pre">bento__entrypoint</span> <span class="pre">}}</span></code> is the path the BentoML entrypoint,
nothinig special here 😏.</p>
</div>
<p>Read more about <code class="code docutils literal notranslate"><span class="pre">CMD</span></code> and <code class="code docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> interaction <a class="reference external" href="https://docs.docker.com/engine/reference/builder/#understand-how-cmd-and-entrypoint-interact">here</a>.</p>
</section>
</section>
</section>
<section id="advanced-options">
<h2>Advanced Options<a class="headerlink" href="#advanced-options" title="Permalink to this heading">#</a></h2>
<p>The next part goes into advanced options. Skip this part if you are not
comfortable with using it.</p>
<section id="dockerfile-variables">
<h3>Dockerfile variables<a class="headerlink" href="#dockerfile-variables" title="Permalink to this heading">#</a></h3>
<p>BentoML does expose some variables that user can modify to fit their needs.</p>
<p>The following are the variables that users can set in their custom Dockerfile template:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Variables</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">bento__home</span></code></p></td>
<td><p>Setup bento home, default to <code class="code docutils literal notranslate"><span class="pre">/home/{{</span> <span class="pre">bento__user</span> <span class="pre">}}</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">bento__user</span></code></p></td>
<td><p>Setup bento user, default to <code class="code docutils literal notranslate"><span class="pre">bentoml</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">bento__uid_gid</span></code></p></td>
<td><p>Setup UID and GID for the user, default to <code class="code docutils literal notranslate"><span class="pre">1034:1034</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">bento__path</span></code></p></td>
<td><p>Setup bento path, default to <code class="code docutils literal notranslate"><span class="pre">/home/{{</span> <span class="pre">bento__user</span> <span class="pre">}}/bento</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p>If any of the aforementioned fields are set with <code class="code docutils literal notranslate"><span class="pre">{%</span> <span class="pre">set</span> <span class="pre">...</span> <span class="pre">%}</span></code>, then we
will use your value instead, otherwise a default value will be used.</p>
</section>
<section id="adding-conda-to-cuda-enabled-bento">
<h3>Adding <code class="code docutils literal notranslate"><span class="pre">conda</span></code> to CUDA-enabled Bento<a class="headerlink" href="#adding-conda-to-cuda-enabled-bento" title="Permalink to this heading">#</a></h3>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><span class="sd-sphinx-override sd-badge sd-bg-warning sd-bg-text-warning">Warning:</span> miniconda install scripts provided by ContinuumIO (the parent company of Anaconda) supports Python 3.7 to 3.9. Make sure that you are using the correct python version under <code class="code docutils literal notranslate"><span class="pre">docker.python_version</span></code>.</p>
</div>
<p>If you need to use conda for CUDA images, use the following template ( <em>partially extracted from</em> <a class="reference external" href="https://github.com/ContinuumIO/docker-images/blob/master/miniconda3/debian/Dockerfile"><code class="code docutils literal notranslate"><span class="pre">ContinuumIO/docker-images</span></code></a> ):</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header sd-text-primary">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg></span>Expands me<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><cite>Dockerfile.template</cite></span><a class="headerlink" href="#id6" title="Permalink to this code">#</a></div>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">import</span> <span class="s1">'_macros.j2'</span> <span class="k">as</span> <span class="nv">common</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">extends</span> <span class="nv">bento_base_template</span> <span class="cp">%}</span>
<span class="c">{# Make sure to change the correct python_version and conda version accordingly. #}</span>
<span class="c">{# example: py38_4.10.3 #}</span>
<span class="c">{# refers to https://repo.anaconda.com/miniconda/ for miniconda3 base #}</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">conda_version</span><span class="o">=</span><span class="s2">"py39_4.11.0"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">conda_path</span><span class="o">=</span><span class="s2">"/opt/conda"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">conda_exec</span><span class="o">=[</span><span class="nv">conda_path</span><span class="o">,</span> <span class="s2">"bin"</span><span class="o">,</span> <span class="s2">"conda"</span><span class="o">]</span> <span class="o">|</span> <span class="nf">join</span><span class="o">(</span><span class="s2">"/"</span><span class="o">)</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">SETUP_BENTO_BASE_IMAGE</span> <span class="cp">%}</span>
<span class="x">FROM debian:bullseye-slim as conda-build</span>

<span class="x">RUN --mount=type=cache,from=cached,sharing=shared,target=/var/cache/apt \</span>
<span class="x">	--mount=type=cache,from=cached,sharing=shared,target=/var/lib/apt \</span>
<span class="x">	apt-get update -y &amp;&amp; \</span>
<span class="x">	apt-get install -y --no-install-recommends --allow-remove-essential \</span>
<span class="x">	software-properties-common \</span>
<span class="x">	bzip2 \</span>
<span class="x">	ca-certificates \</span>
<span class="x">	git \</span>
<span class="x">	libglib2.0-0 \</span>
<span class="x">	libsm6 \</span>
<span class="x">	libxext6 \</span>
<span class="x">	libxrender1 \</span>
<span class="x">	mercurial \</span>
<span class="x">	openssh-client \</span>
<span class="x">	procps \</span>
<span class="x">	subversion \</span>
<span class="x">	wget &amp;&amp; \</span>
<span class="x">	apt-get clean</span>

<span class="x">ENV PATH </span><span class="cp">{{</span> <span class="nv">conda_path</span> <span class="cp">}}</span><span class="x">/bin:$PATH</span>

<span class="x">ARG CONDA_VERSION=</span><span class="cp">{{</span> <span class="nv">conda_version</span> <span class="cp">}}</span>

<span class="x">RUN set -ex &amp;&amp; \</span>
<span class="x">	UNAME_M=$(uname -m) &amp;&amp; \</span>
<span class="x">	if [ "${UNAME_M}" = "x86_64" ]; then \</span>
<span class="x">	MINICONDA_URL="https://repo.anaconda.com/miniconda/Miniconda3-${CONDA_VERSION}-Linux-x86_64.sh"; \</span>
<span class="x">	SHA256SUM="4ee9c3aa53329cd7a63b49877c0babb49b19b7e5af29807b793a76bdb1d362b4"; \</span>
<span class="x">	elif [ "${UNAME_M}" = "s390x" ]; then \</span>
<span class="x">	MINICONDA_URL="https://repo.anaconda.com/miniconda/Miniconda3-${CONDA_VERSION}-Linux-s390x.sh"; \</span>
<span class="x">	SHA256SUM="e5e5e89cdcef9332fe632cd25d318cf71f681eef029a24495c713b18e66a8018"; \</span>
<span class="x">	elif [ "${UNAME_M}" = "aarch64" ]; then \</span>
<span class="x">	MINICONDA_URL="https://repo.anaconda.com/miniconda/Miniconda3-${CONDA_VERSION}-Linux-aarch64.sh"; \</span>
<span class="x">	SHA256SUM="00c7127a8a8d3f4b9c2ab3391c661239d5b9a88eafe895fd0f3f2a8d9c0f4556"; \</span>
<span class="x">	elif [ "${UNAME_M}" = "ppc64le" ]; then \</span>
<span class="x">	MINICONDA_URL="https://repo.anaconda.com/miniconda/Miniconda3-${CONDA_VERSION}-Linux-ppc64le.sh"; \</span>
<span class="x">	SHA256SUM="8ee1f8d17ef7c8cb08a85f7d858b1cb55866c06fcf7545b98c3b82e4d0277e66"; \</span>
<span class="x">	fi &amp;&amp; \</span>
<span class="x">	wget "${MINICONDA_URL}" -O miniconda.sh -q &amp;&amp; echo "${SHA256SUM} miniconda.sh" &gt; shasum &amp;&amp; \</span>
<span class="x">	if [ "${CONDA_VERSION}" != "latest" ]; then \</span>
<span class="x">	sha256sum --check --status shasum; \</span>
<span class="x">	fi &amp;&amp; \</span>
<span class="x">	mkdir -p /opt &amp;&amp; \</span>
<span class="x">	sh miniconda.sh -b -p </span><span class="cp">{{</span> <span class="nv">conda_path</span> <span class="cp">}}</span><span class="x"> &amp;&amp; rm miniconda.sh shasum &amp;&amp; \</span>
<span class="x">	find </span><span class="cp">{{</span> <span class="nv">conda_path</span> <span class="cp">}}</span><span class="x">/ -follow -type f -name '*.a' -delete &amp;&amp; \</span>
<span class="x">	find </span><span class="cp">{{</span> <span class="nv">conda_path</span> <span class="cp">}}</span><span class="x">/ -follow -type f -name '*.js.map' -delete &amp;&amp; \</span>
<span class="x">	</span><span class="cp">{{</span> <span class="nv">conda_exec</span> <span class="cp">}}</span><span class="x"> clean -afy</span>

<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>

<span class="x">ENV PATH </span><span class="cp">{{</span> <span class="nv">conda_path</span> <span class="cp">}}</span><span class="x">/bin:$PATH</span>

<span class="x">COPY --from=conda-build </span><span class="cp">{{</span> <span class="nv">conda_path</span> <span class="cp">}}</span><span class="x"> </span><span class="cp">{{</span> <span class="nv">conda_path</span> <span class="cp">}}</span>

<span class="x">RUN set -ex &amp;&amp; \</span>
<span class="x">	ln -s </span><span class="cp">{{</span> <span class="nv">conda_path</span> <span class="cp">}}</span><span class="x">/etc/profile.d/conda.sh /etc/profile.d/conda.sh &amp;&amp; \</span>
<span class="x">	echo ". </span><span class="cp">{{</span> <span class="nv">conda_path</span> <span class="cp">}}</span><span class="x">/etc/profile.d/conda.sh" &gt;&gt; ~/.bashrc &amp;&amp; \</span>
<span class="x">	echo "</span><span class="cp">{{</span> <span class="nv">conda_exec</span> <span class="cp">}}</span><span class="x"> activate base" &gt;&gt; ~/.bashrc</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">SETUP_BENTO_ENVARS</span> <span class="cp">%}</span>

<span class="x">SHELL [ "/bin/bash", "-eo", "pipefail", "-c" ]</span>
<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">common.setup_conda</span><span class="o">(</span><span class="nv">__python_version__</span><span class="o">,</span> <span class="nv">bento__path</span><span class="o">,</span> <span class="nv">conda_path</span><span class="o">=</span><span class="nv">conda_path</span><span class="o">)</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
</details></section>
<section id="containerization-with-different-container-engines">
<h3>Containerization with different container engines.<a class="headerlink" href="#containerization-with-different-container-engines" title="Permalink to this heading">#</a></h3>
<p>In BentoML version 1.0.11 <a class="footnote-reference brackets" href="#pr-3164" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, we support different container engines aside from docker.</p>
<p>BentoML-generated Dockerfiles from version 1.0.11 onward will be OCI-compliant and can be built with:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.docker.com/">Docker</a></p></li>
<li><p><a class="reference external" href="https://podman.io/">Podman</a></p></li>
<li><p><a class="reference external" href="https://buildah.io/">Buildah</a></p></li>
<li><p><a class="reference external" href="https://github.com/containerd/nerdctl">nerdctl</a></p></li>
<li><p><a class="reference external" href="https://github.com/moby/buildkit/blob/master/docs/buildctl.md">buildctl</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/engine/reference/commandline/buildx/">Docker buildx</a></p></li>
</ul>
<p>To use any of the aforementioned backends, they must be installed on your system. Refer to their documentation for installation and setup.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, BentoML will use Docker as the container backend.
To use other container engines, please set the environment variable <code class="docutils literal notranslate"><span class="pre">BENTOML_CONTAINERIZE_BACKEND</span></code> or
pass in <code class="docutils literal notranslate"><span class="pre">--backend</span></code> to <a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/cli.html#bentoml-containerize"><span class="std std-ref">bentoml containerize</span></a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># set environment variable</span>
<span class="nv">BENTOML_CONTAINERIZE_BACKEND</span><span class="o">=</span>buildah<span class="w"> </span>bentoml<span class="w"> </span>containerize<span class="w"> </span>pytorch-mnist

<span class="c1"># or pass in --backend</span>
bentoml<span class="w"> </span>containerize<span class="w"> </span>pytorch-mnist:latest<span class="w"> </span>--backend<span class="w"> </span>buildah
</pre></div>
</div>
</div>
<p>To build a BentoContainer in Python, you can use the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/container.html#container-apis"><span class="std std-ref">Container SDK</span></a> method <a class="reference internal" href="../reference/container.html#bentoml.container.build" title="bentoml.container.build"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.container.build()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bentoml</span>

<span class="n">bentoml</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
   <span class="s2">"pytorch-mnist:latest"</span><span class="p">,</span>
   <span class="n">backend</span><span class="o">=</span><span class="s2">"podman"</span><span class="p">,</span>
   <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">"grpc"</span><span class="p">,</span><span class="s2">"grpc-reflection"</span><span class="p">],</span>
   <span class="n">cache_from</span><span class="o">=</span><span class="s2">"registry.com/my_cache:v1"</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<section id="register-custom-backend">
<h4>Register custom backend<a class="headerlink" href="#register-custom-backend" title="Permalink to this heading">#</a></h4>
<p>To register a new backend, there are two functions that need to be implemented:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">arg_parser_func</span></code>: a function that takes in keyword arguments that represents the builder
commandline arguments and returns a <code class="docutils literal notranslate"><span class="pre">list[str]</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arg_parser_func</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">context_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"."</span><span class="p">,</span>
    <span class="n">cache_from</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">cache_from</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">"--cache-from"</span><span class="p">,</span> <span class="n">cache_from</span><span class="p">])</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">context_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">health_func</span></code>: a function that returns a <code class="docutils literal notranslate"><span class="pre">bool</span></code> to indicate if the backend is available:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">def</span> <span class="nf">health_func</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">"limactl"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</pre></div>
</div>
</li>
</ul>
<p>To register a new backend, use <a class="reference internal" href="../reference/container.html#bentoml.container.register_backend" title="bentoml.container.register_backend"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.container.register_backend()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bentoml.container</span> <span class="kn">import</span> <span class="n">register_backend</span>

<span class="n">register_backend</span><span class="p">(</span>
   <span class="s2">"lima"</span><span class="p">,</span>
   <span class="n">binary</span><span class="o">=</span><span class="s2">"/usr/bin/limactl"</span><span class="p">,</span>
   <span class="n">buildkit_support</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
   <span class="n">health</span><span class="o">=</span><span class="n">health_func</span><span class="p">,</span>
   <span class="n">construct_build_args</span><span class="o">=</span><span class="n">arg_parser_func</span><span class="p">,</span>
   <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s2">"DOCKER_BUILDKIT"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header sd-text-primary">
Backward compatibility with <code class="docutils literal notranslate"><span class="pre">bentoml.bentos.containerize</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Before 1.0.11, BentoML uses <a class="reference internal" href="../reference/core.html#bentoml.bentos.containerize" title="bentoml.bentos.containerize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.bentos.containerize()</span></code></a> to containerize Bento. This method is now deprecated and will be removed in the future.</p>
</div>
</details></section>
<section id="buildkit-interop">
<h4>BuildKit interop<a class="headerlink" href="#buildkit-interop" title="Permalink to this heading">#</a></h4>
<p>BentoML leverages <a class="reference external" href="https://github.com/moby/buildkit">BuildKit</a> for a more extensive feature set. However, we recognise that
BuildKit has come with a lot of friction for migration purposes as well as restrictions to use with other build tools (such as podman, buildah, kaniko).</p>
<p>Therefore, since BentoML version 1.0.11, BuildKit will be an opt-out. To disable BuildKit, pass <code class="docutils literal notranslate"><span class="pre">DOCKER_BUILDKIT=0</span></code> to
<a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/cli.html#bentoml-containerize"><span class="std std-ref">bentoml containerize</span></a>, which aligns with the behaviour of <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>bentoml<span class="w"> </span>containerize<span class="w"> </span>...
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All Bento container will now be following OCI spec instead of Docker spec. The difference is that in OCI spec, there is no SHELL argument.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The generated Dockerfile included inside the Bento will be a minimal Dockerfile, which ensures compatibility among build tools. We encourage users to always use
<a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/cli.html#bentoml-containerize"><span class="std std-ref">bentoml containerize</span></a>.</p>
<p><em>If you wish to use the generated Dockerfile, make sure that you know what you are doing!</em></p>
</div>
</section>
<section id="cli-enhancement">
<h4>CLI enhancement<a class="headerlink" href="#cli-enhancement" title="Permalink to this heading">#</a></h4>
<p>To better support different backends, <a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/cli.html#bentoml-containerize"><span class="std std-ref">bentoml containerize</span></a>
will be more agnostic when it comes to parsing options.</p>
<p>One can pass in options for specific backend with <code class="docutils literal notranslate"><span class="pre">--opt</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>bentoml<span class="w"> </span>containerize<span class="w"> </span>pytorch-mnist:latest<span class="w"> </span>--backend<span class="w"> </span>buildx<span class="w"> </span>--opt<span class="w"> </span><span class="nv">platform</span><span class="o">=</span>linux/arm64
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">--opt</span></code> also accepts parsing <code class="docutils literal notranslate"><span class="pre">:</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>bentoml<span class="w"> </span>containerize<span class="w"> </span>pytorch-mnist:latest<span class="w"> </span>--backend<span class="w"> </span>buildx<span class="w"> </span>--opt<span class="w"> </span>platform:linux/arm64
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are seeing a warning message like:</p>
<div class="highlight-prolog notranslate"><div class="highlight"><pre><span></span><span class="s s-Atom">'--platform=linux/arm64'</span> <span class="o">is</span> <span class="s s-Atom">now</span> <span class="s s-Atom">deprecated</span><span class="p">,</span> <span class="s s-Atom">use</span> <span class="s s-Atom">the</span> <span class="s s-Atom">equivalent</span> <span class="s s-Atom">'--opt platform=linux/arm64'</span> <span class="s s-Atom">instead</span><span class="p">.</span>
</pre></div>
</div>
<p>BentoML used to depends on Docker buildx. These options are now backward compatible with <code class="docutils literal notranslate"><span class="pre">--opt</span></code>. You can safely ignore this warning and use
<code class="docutils literal notranslate"><span class="pre">--opt</span></code> to pass options for <code class="docutils literal notranslate"><span class="pre">--backend=buildx</span></code>.</p>
</div>
<hr class="docutils">
<p class="rubric">Notes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="pr-3164" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">1</a><span class="fn-bracket">]</span></span>
<p>Introduction of container builder to build Bento into OCI-compliant image: <a class="reference external" href="https://github.com/bentoml/BentoML/pull/3164">bentoml/BentoML/pull/3164</a></p>
</aside>
</aside>
</section>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="client.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Bento Client</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="batching.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Adaptive Batching</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright © 2022-2023, bentoml.com
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/bentoml/bentoml" aria-label="GitHub"> 🍱 </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Advanced Containerization</a><ul>
<li><a class="reference internal" href="#why-you-may-need-this">Why you may need this?</a></li>
<li><a class="reference internal" href="#custom-base-image">Custom Base Image</a></li>
<li><a class="reference internal" href="#dockerfile-template">Dockerfile Template</a></li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#building-tensorflow-custom-op">Building TensorFlow custom op</a></li>
<li><a class="reference internal" href="#access-aws-credentials-during-image-build">Access AWS credentials during image build</a><ul>
<li><a class="reference internal" href="#using-environment-variables">Using environment variables</a></li>
<li><a class="reference internal" href="#mount-credentials-from-host">Mount credentials from host</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#writing-dockerfile-template">Writing <code class="code docutils literal notranslate"><span class="pre">dockerfile_template</span></code></a><ul>
<li><a class="reference internal" href="#jinja-templates">Jinja templates</a><ul>
<li><a class="reference internal" href="#super"><code class="code docutils literal notranslate"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></code></a></li>
<li><a class="reference internal" href="#blocks">Blocks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dockerfile-instruction">Dockerfile instruction</a><ul>
<li><a class="reference internal" href="#workdir"><code class="code docutils literal notranslate"><span class="pre">WORKDIR</span></code></a></li>
<li><a class="reference internal" href="#entrypoint"><code class="code docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-options">Advanced Options</a><ul>
<li><a class="reference internal" href="#dockerfile-variables">Dockerfile variables</a></li>
<li><a class="reference internal" href="#adding-conda-to-cuda-enabled-bento">Adding <code class="code docutils literal notranslate"><span class="pre">conda</span></code> to CUDA-enabled Bento</a></li>
<li><a class="reference internal" href="#containerization-with-different-container-engines">Containerization with different container engines.</a><ul>
<li><a class="reference internal" href="#register-custom-backend">Register custom backend</a></li>
<li><a class="reference internal" href="#buildkit-interop">BuildKit interop</a></li>
<li><a class="reference internal" href="#cli-enhancement">CLI enhancement</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/js/hoverxref.js"></script>
    <script src="../_static/js/tooltipster.bundle.min.js"></script>
    <script src="../_static/js/micromodal.min.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async="async" src="/_/static/javascript/readthedocs-doc-embed.js"></script>
    <script src="../_static/js/custom.js"></script>
    
<div id="PapercupsChatWidget"><iframe title="Papercups Chat Widget Container" class="Papercups-chatWindowContainer css-um7ixe" sandbox="allow-scripts allow-popups allow-same-origin allow-forms" src="https://chat-widget.papercups.io?accountId=25ad5fd9-293b-4e0f-9601-5b0cd7846b48&amp;baseUrl=https%3A%2F%2Fyatai-community-papercups.herokuapp.com&amp;closeable=1&amp;debug=0&amp;disableAnalyticsTracking=0&amp;greeting=Hi%20there%21%20How%20can%20I%20help%20you%3F%20If%20we%20couldn%27t%20get%20back%20to%20you%20in%20time%2C%20feel%20free%20to%20join%20our%20community%20on%20slack%20and%20post%20your%20question%20in%20the%20%23support%20channel%3A%20https%3A%2F%2Fl.linklyhq.com%2Fl%2FktOX&amp;inbox=ac3ebd50-fc10-4299-9a1c-496841b49a6f&amp;metadata=%7B%22os%22%3A%22Mac%20OS%20X%22%2C%22browser%22%3A%22Chrome%22%2C%22time_zone%22%3A%22America%2FLos_Angeles%22%2C%22current_url%22%3A%22https%3A%2F%2Fdocs.bentoml.org%2Fen%2Flatest%2Fguides%2Fcontainerization.html%22%2C%22host%22%3A%22docs.bentoml.org%22%2C%22pathname%22%3A%22%2Fen%2Flatest%2Fguides%2Fcontainerization.html%22%2C%22browser_version%22%3A%22111%22%2C%22screen_height%22%3A720%2C%22screen_width%22%3A1280%2C%22lib%22%3A%22web%22%2C%22insert_id%22%3A%2215b1ri9882rdwjb9%22%2C%22time%22%3A1679951014.447%7D&amp;primaryColor=%2347AFD1&amp;requireEmailUpfront=1&amp;showAgentAvailability=1&amp;subtitle=Ask%20us%20anything%20in%20the%20chat%20window%20below%20%F0%9F%98%8A&amp;title=Welcome%20to%20BentoML%21&amp;token=25ad5fd9-293b-4e0f-9601-5b0cd7846b48&amp;ts=1679951013687&amp;version=1.2.0" style="pointer-events: none; height: 0px; min-height: 0px; opacity: 0; transform: translateY(4px) translateZ(0px);">Loading...</iframe></div><div style="display: none; visibility: hidden;"><script src="https://t.jitsu.com/s/lib.js" data-key="js.jqho3vy91pn32tceppam.y74ysav0xrdi5kv13hdpfc" data-init-only="false" defer="defer"></script></div></body></html>